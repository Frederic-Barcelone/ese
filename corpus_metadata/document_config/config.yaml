# ==============================================================================
# RARE DISEASE EXTRACTION - PIPELINE CONFIGURATION v14.0
# ==============================================================================
# corpus_metadata/document_config/config.yaml
#
# VERSION 14.0 CHANGES:
# - Removed abbreviation extraction and validation (now disease/drug only)
# - Removed promotion config (was for abbreviationâ†’entity promotion)
# - Simplified deduplication to drug/disease only
#
# Environment Variables:
#   CORPUS_BASE_PATH - Base path for all resources (default: parent of corpus_metadata)
#   ANTHROPIC_API_KEY - API key for Claude AI validation (or CLAUDE_API_KEY)

system:
  name: "Rare Disease Document Extraction"
  version: "14.0"

# ==============================================================================
# PATHS (relative to CORPUS_BASE_PATH or absolute)
# ==============================================================================
paths:
  dictionaries: "corpus_dictionaries/output_datasources"
  databases: "corpus_db"
  logs: "corpus_logs"
  cache: "cache"

# ==============================================================================
# GLOBAL DEFAULTS
# ==============================================================================
defaults:
  confidence_threshold: 0.75
  fuzzy_match_threshold: 85
  context_window: 100
  min_term_length: 3
  prefix_start_number: 1000


# ==============================================================================
# FEATURE FLAGS
# ==============================================================================
features:
  # Core extraction
  drug_detection: true
  disease_detection: true
  
  # Document analysis
  classification: true
  section_detection: true
  table_extraction: true
  
  # Metadata extraction
  title_extraction: true
  date_extraction: true
  description_extraction: true
  
  # Citation/Reference extraction
  citation_extraction: true
  person_extraction: true
  reference_extraction: true
  
  # External APIs (WARNING - PRIVACY: sends data to third-party services)
  pubtator_enrichment: true
  ai_validation: true  # Enable Claude validation
  
  # File operations
  intelligent_rename: true
  caching: true

# ==============================================================================
# RESOURCES (filenames relative to paths.dictionaries)
# ==============================================================================
resources:
  disease_lexicon: "2025_08_lexicon_disease.json"
  disease_rare_acronyms: "2025_08_rare_disease_acronyms.json"
  # Disease-specific supplemental lexicons
  disease_lexicon_pah: "disease_lexicon_pah.json"    # PAH (Pulmonary Arterial Hypertension)
  disease_lexicon_anca: "disease_lexicon_anca.json"  # ANCA-associated vasculitis
  disease_lexicon_igan: "disease_lexicon_igan.json"  # IgA Nephropathy
  drug_lexicon: "2025_08_lexicon_drug.json"
  drug_alexion: "2025_08_alexion_drugs.json"
  drug_fda_approved: "2025_08_fda_approved_drugs.json"
  drug_investigational: "2025_08_investigational_drugs.json"
  medical_terms_lexicon: "2025_08_lexicon_medical_terms.json"
  document_types: "2025_08_document_types.json"
  clinical_trial_metadata: "00966_clinical_trial_metadata.json"

# ==============================================================================
# DATABASES (filenames relative to paths.databases)
# ==============================================================================
databases:
  disease_ontology: "disease_ontology.db"
  disease_orphanet: "orphanet_nlp.db"

# ==============================================================================
# PIPELINE
# ==============================================================================
pipeline:
  stages:
    - name: metadata
      sequence: 1
      limits:
        pdf_pages: 10
        text_chars: 10000
      tasks:
        - classification
        - title_extraction
        - date_extraction
        - description_extraction
    
    - name: entities
      sequence: 2
      limits:
        pdf_pages: null
        text_chars: null
      tasks:
        - drug_detection
        - disease_detection
        - citation_extraction
        - person_extraction
        - reference_extraction

# ==============================================================================
# API CONFIGURATION - TWO-TIER CLAUDE MODEL
# ==============================================================================
# 
# TWO-TIER STRATEGY:
# - fast: Cheaper/faster model for basic tasks (classification, initial extraction)
# - validation: Best model for final validation & enrichment (catches subtle errors)
#
# This optimizes cost while ensuring quality where it matters most.
# ==============================================================================
api:
  pubtator:
    base_url: "https://www.ncbi.nlm.nih.gov/research/pubtator3-api"
    timeout_seconds: 30
    rate_limit_per_minute: 30
  
  claude:
    # -------------------------------------------------------------------------
    # FAST MODEL - For basic tasks (cheaper, faster)
    # -------------------------------------------------------------------------
    # Used for: document classification, title extraction, initial processing
    fast:
      model: "claude-sonnet-4-5-20250929"
      max_tokens: 1500
      temperature: 0
    
    # -------------------------------------------------------------------------
    # VALIDATION MODEL - For final validation & enrichment (best quality)
    # -------------------------------------------------------------------------
    # Used for: drug validation, disease validation
    validation:
      model: "claude-opus-4-5-20251101"  # Best model for validation quality
      max_tokens: 4096
      temperature: 0
    
    # -------------------------------------------------------------------------
    # LEGACY (backward compatibility)
    # -------------------------------------------------------------------------
    model: "claude-sonnet-4-5-20250929"
    max_tokens: 1500
    temperature: 0

# ==============================================================================
# VALIDATION CONFIGURATION
# ==============================================================================
# 
# Each entity type can be validated with Claude:
# - model_tier: "fast" or "validation" - which Claude model to use
# ==============================================================================
validation:
  # Drug validation
  drug:
    enabled: true
    model_tier: "validation"
    confidence_threshold: 0.85
    stages: ["false_positive_filter", "knowledge_base", "claude_ai"]
  
  # Disease validation
  disease:
    enabled: true
    model_tier: "validation"
    confidence_threshold: 0.75
    enrichment_mode: "balanced"
    stages: ["pattern_detection", "lexicon_matching", "claude_ai"]

# ==============================================================================
# DEDUPLICATION
# ==============================================================================
deduplication:
  enabled: true
  priority_order: ["drug", "disease"]
  remove_expansion_matches: true

# ==============================================================================
# EXTRACTION SETTINGS
# ==============================================================================
extraction:
  citation:
    detect_style: true
    link_inline: true
    extract_identifiers: true
  
  person:
    extract_affiliations: true
    classify_roles: true
    validate_orcid: true
  
  reference:
    extract_all_types: true
    reconstruct_urls: true
    classify_roles: true

# ==============================================================================
# OUTPUT
# ==============================================================================
output:
  format: "json"
  json_indent: 2
  include:
    statistics: true
    confidence: true
    context: true
    identifiers: true

# ==============================================================================
# LOGGING
# ==============================================================================
logging:
  level: "INFO"
  console: false
  console_level: "ERROR"
  file: "corpus.log"
  max_size_mb: 10
  backup_count: 5

# ==============================================================================
# RUNTIME
# ==============================================================================
runtime:
  batch_size: 10
  timeout_seconds: 300
  max_file_size_mb: 100
  on_error: "log_and_continue"